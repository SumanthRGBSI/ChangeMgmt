<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Change Management View</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a', 950: '#172554',
                        },
                    }
                }
            }
        }
    </script>
    <style type="text/css">
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 50; }
        .modal-content { background-color: white; padding: 2rem; border-radius: 0.5rem; max-width: 50rem; width: 90%; max-height: 90vh; overflow-y: auto; }
        .tooltip { position: relative; display: inline-flex; align-items: center; }
        .tooltip .tooltip-text { visibility: hidden; width: 160px; background-color: #555; color: #fff; text-align: center; border-radius: 6px; padding: 5px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -80px; opacity: 0; transition: opacity 0.3s; }
        .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- MOCK DATA (V4) ---
        let mockData = {
            crNumber: "CR-2025-00123",
            crName: "Update Main Housing Assembly - V2",
            overallStatus: "In Progress",
            users: ["Alex Chen", "Sarah Lee", "John Smith", "Jane Doe", "Mike Brown", "Director Ops", "QA Lead"],
            riskLevels: ["Critical", "High", "Medium", "Low"],
            unreadConversations: 2,
            statusHistory: [ { status: "In Progress", date: "2025-10-22", user: "Jane Doe" }, { status: "Initiated", date: "2025-10-20", user: "Alex Chen" } ],
            details: { /* ... */ },
            riskAssessment: { /* ... */ },
            actionItems: [ /* ... */ ],
            authorization: {
                templates: {
                    "Standard Engineering Change": [
                        { level: 1, role: "Initiator" }, { level: 2, role: "Coordinator" }, { level: 3, role: "Risk Analyst (Tech)" }, { level: 3, role: "Risk Analyst (Finance)" }, { level: 4, role: "Final Approver" }
                    ],
                    "Fast-Track Minor Change": [
                        { level: 1, role: "Initiator" }, { level: 2, role: "Coordinator" }, { level: 3, role: "QA Lead" }, { level: 4, role: "Final Approver" }
                    ],
                },
                roles: [
                    { level: 1, role: "Initiator", user: "Alex Chen", status: "Signed", signature: "A.C.", date: "2025-10-20" },
                    { level: 2, role: "Coordinator", user: "Jane Doe", status: "Signed", signature: "J.D.", date: "2025-10-21" },
                    { level: 3, role: "Risk Analyst (Tech)", user: "", status: "Not Started", signature: "", date: "" },
                    { level: 3, role: "Risk Analyst (Finance)", user: "", status: "Not Started", signature: "", date: "" },
                    { level: 4, role: "Final Approver", user: "", status: "Not Started", signature: "", date: "" },
                ]
            },
            conversation: [ { user: "Jane Doe", avatar: "https://i.pravatar.cc/40?u=jane", text: "Initial review is done. @Alex Chen can you please prioritize the feasibility study?", time: "2 hours ago" }, { user: "Alex Chen", avatar: "https://i.pravatar.cc/40?u=alex", text: "Understood. Tooling tests are scheduled for next week. I'll update the risk assessment as soon as I have the preliminary results.", time: "1 hour ago" } ],
        };
        // Fill in missing data from previous version
        mockData.details = {
            collapsed: { supplierName: "ACME Corp Manufacturing", supplierCode: "ACM-001", partName: "Main Housing Assembly", partNumber: "PN-456-V1", coordinator: "Jane Doe", supplierCoordinator: "John Smith" },
            basicInfo: {
                left: { crNumber: "CR-2025-00123", supplierChangeNumber: "SCN-98765", supplierPartNumber: "PN-456-V1", partName: "Main Housing Assembly", partRevision: "V1", customer: "Global Motors Inc.", coordinator: "Jane Doe", buyer: "Sarah Lee", creationDate: "2025-10-20", categoryType: "Product", changeReason: "Quality Improvement", proposedChange: "This change involves re-tooling the main injection mold to improve material flow and reduce defects.", comments: "Initial review complete. Awaiting risk assessment from engineering." },
                right: { crName: "Update Main Housing Assembly - V2", program: "Model G - Drivetrain", eNumber: "E-102938", partClassification: "Major Component", initiator: "Alex Chen", secondaryCoordinator: "Mike Brown", changeCategory: "Tooling", targetImplementationDate: "2025-12-01", materialStatus: "Production", links: [{ name: "Engineering Specs", url: "#" }, { name: "CAD Files", url: "#" }] }
            },
            supplierDetails: { supplier: "ACME Corp Manufacturing (ACM-001)", supplierCoordinator: "John Smith", supplierLocation: "Guadalajara, Mexico", supplierPlant: "ACME Plant #4", supplierCoordinatorEmail: "john.smith@acme.com" },
            additionalDetails: [
                { label: "Is Commercial Impact?", value: true, description: "Cost increase is projected to be 3.5%." },
                { label: "Is Customer Impact?", value: true, description: "Customer must validate the new part." },
                { label: "Implementation Date Agreed with Customer?", value: false, description: "" },
                { label: "Will Supplier Part Number Change?", value: true, description: "New part number will be PN-456-V2." },
                { label: "Will Customer Part Number Change?", value: true, description: "" },
                { label: "Will Material Change?", value: true, description: "Material composition updated to standard-B." },
                { label: "Is Tooling Affected?", value: true, description: "Requires new mold insert." },
                { label: "Is Software/Firmware Affected?", value: false, description: "" }
            ],
            relatedParts: [
                { number: "PN-456-V1-SUB1", name: "Sub-assembly A", revision: "V1" },
                { number: "PN-456-V1-SUB2", name: "Sub-assembly B", revision: "V1" },
                { number: "PN-100-BOLT", name: "Mounting Bolt", revision: "V3" },
                { number: "PN-101-NUT", name: "Mounting Nut", revision: "V2" },
                { number: "PN-200-BRACKET", name: "Support Bracket", revision: "V1" },
                { number: "PN-201-GASKET", name: "Sealing Gasket", revision: "V4" },
                { number: "PN-300-WIRING", name: "Wiring Harness", revision: "V1" },
                { number: "PN-301-CLIP", name: "Harness Clip", revision: "V2" },
            ]
        };
        mockData.riskAssessment = { groups: [ { name: "Design & Technical Risk", applicable: true, categories: [ { id: 1, category: "Feasibility", responsible: "Alex Chen", dueDate: "2025-11-15", risk: "Medium", status: "In Progress", rating: 4, weightage: 40, comments: "Tooling tests pending.", attachments: [{id: 1, name: 'spec-v1.pdf'}, {id: 2, name: 'test-plan.docx'}], history: [] }, { id: 2, category: "Material Spec", responsible: "Alex Chen", dueDate: "2025-11-18", risk: "Low", status: "Pending", rating: 2, weightage: 20, comments: "", attachments: [], history: [] } ] }, { name: "Financial & Commercial Risk", applicable: true, categories: [ { id: 3, category: "Cost Analysis", responsible: "Sarah Lee", dueDate: "2025-11-10", risk: "Low", status: "Completed", rating: 2, weightage: 30, comments: "Cost increase within 5% tolerance.", attachments: [{id: 3, name: 'cost-analysis.xlsx'}], history: [] } ] }, { name: "Logistics", applicable: false, categories: [ { id: 4, category: "Supply Chain", responsible: "John Smith", dueDate: "2025-11-20", risk: "High", status: "Pending", rating: 0, weightage: 10, comments: "", attachments: [], history: [] } ] } ] };
        mockData.actionItems = [ { id: 1, assessmentCategory: "Cost Analysis", name: "Finalize budget report", responsible: "Sarah Lee", dueDate: "2025-11-12", status: "Completed" }, { id: 2, assessmentCategory: "Feasibility", name: "Begin tooling tests", responsible: "Alex Chen", dueDate: "2025-11-18", status: "In Progress" }, { id: 3, assessmentCategory: "Feasibility", name: "Validate material compatibility", responsible: "Alex Chen", dueDate: "2025-11-22", status: "Pending" } ];

        // --- ICONS (V4) ---
        const SVG = ({ className, children, size = 24, ...props }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>;
        const ICONS = { CheckCircle: (p) => <SVG {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></SVG>, ChevronDown: (p) => <SVG {...p}><polyline points="6 9 12 15 18 9"/></SVG>, Info: (p) => <SVG {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></SVG>, Users: (p) => <SVG {...p}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></SVG>, List: (p) => <SVG {...p}><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></SVG>, Shield: (p) => <SVG {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></SVG>, Plus: (p) => <SVG {...p}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></SVG>, MessageSquare: (p) => <SVG {...p}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></SVG>, History: (p) => <SVG {...p}><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></SVG>, Paperclip: (p) => <SVG {...p}><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.59a2 2 0 0 1-2.83-2.83l.79-.79"/></SVG>, MoreVertical: (p) => <SVG {...p}><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></SVG>, Send: (p) => <SVG {...p}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></SVG>, Trash2: (p) => <SVG {...p}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></SVG>, UploadCloud: (p) => <SVG {...p}><path d="M16 16l-4-4-4 4"/><path d="M12 12v9"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/><path d="M16 16"/></SVG>, Menu: (p) => <SVG {...p}><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></SVG>, Building: (p) => <SVG {...p}><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><line x1="8" y1="22" x2="8" y2="4"/><line x1="16" y1="22" x2="16" y2="4"/><line x1="4" y1="10" x2="20" y2="10"/></SVG>, Package: (p) => <SVG {...p}><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></SVG>, Edit: (p) => <SVG {...p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></SVG>, Upload: (p) => <SVG {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></SVG>, RotateCcw: (p) => <SVG {...p}><path d="M3 2v6h6"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L3 12"/></SVG> };

        // --- UI COMPONENTS (V4) ---
        const Card = ({ children, className }) => <div className={`bg-white border border-gray-200 rounded-lg shadow-sm ${className}`}>{children}</div>;
        const CardHeader = ({ children }) => <div className="p-4 border-b border-gray-200 flex justify-between items-center">{children}</div>;
        const CardContent = ({ children, className }) => <div className={`p-4 ${className}`}>{children}</div>;
        const Button = ({ children, onClick, variant = 'primary', className, ...props }) => {
            const baseClasses = "px-3 py-1.5 rounded-md font-semibold text-xs inline-flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 transition-colors";
            const variants = { primary: "bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500", secondary: "bg-gray-200 text-gray-700 hover:bg-gray-300 focus:ring-gray-400", ghost: "bg-transparent text-gray-500 hover:text-primary-600 hover:bg-primary-50" };
            return <button onClick={onClick} className={`${baseClasses} ${variants[variant]} ${className}`} {...props}>{children}</button>;
        };
        const StatusBadge = ({ status }) => {
            const config = { "In Progress": "bg-blue-100 text-blue-800", "Completed": "bg-green-100 text-green-800", "Pending": "bg-yellow-100 text-yellow-800", "Not Started": "bg-gray-100 text-gray-800", "Signed": "bg-green-100 text-green-800" }[status] || "bg-gray-100 text-gray-800";
            return <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${config}`}>{status}</span>;
        };

        // --- INLINE EDITABLE COMPONENTS ---
        const EditableCell = ({ value, onSave, type = 'text' }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [currentValue, setCurrentValue] = useState(value);
            const inputRef = useRef(null);
            useEffect(() => { if (isEditing) { inputRef.current?.focus(); inputRef.current?.select(); } }, [isEditing]);
            const handleSave = () => { onSave(currentValue); setIsEditing(false); };
            const handleKeyDown = (e) => { if (e.key === 'Enter') handleSave(); if (e.key === 'Escape') setIsEditing(false); };
            return isEditing ? <input ref={inputRef} type={type} value={currentValue} onChange={e => setCurrentValue(e.target.value)} onBlur={handleSave} onKeyDown={handleKeyDown} className="w-full p-1 border border-primary-300 rounded-md shadow-sm text-sm" /> : <div onClick={() => setIsEditing(true)} className="hover:bg-gray-100 p-1 rounded-md cursor-pointer w-full h-full text-left truncate">{value || '-'}</div>;
        };
        const EditableDropdown = ({ value, onSave, options }) => {
            const handleSave = (newValue) => { onSave(newValue); };
            return <select value={value} onChange={e => handleSave(e.target.value)} className="w-full p-1 border-gray-300 rounded-md shadow-sm text-sm focus:border-primary-500 focus:ring-primary-500">{!value && <option value="">Select...</option>}{options.map(opt => <option key={opt} value={opt}>{opt}</option>)}</select>;
        };

        const SearchableDropdown = ({ value, onSave, options }) => {
            const [searchTerm, setSearchTerm] = useState("");
            const [isOpen, setIsOpen] = useState(false);
            const filteredOptions = options.filter(opt => opt.toLowerCase().includes(searchTerm.toLowerCase()));
            const ref = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (ref.current && !ref.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [ref]);

            const handleSelect = (option) => {
                onSave(option);
                setSearchTerm("");
                setIsOpen(false);
            };

            return (
                <div className="relative" ref={ref}>
                    <div onClick={() => setIsOpen(!isOpen)} className="hover:bg-gray-100 p-1 rounded-md cursor-pointer w-full h-full text-left truncate">{value || 'Select...'}</div>
                    {isOpen && (
                        <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg">
                            <input
                                type="text"
                                placeholder="Search..."
                                className="w-full p-2 border-b border-gray-200"
                                value={searchTerm}
                                onChange={e => setSearchTerm(e.target.value)}
                            />
                            <ul className="max-h-48 overflow-y-auto">
                                {filteredOptions.map(opt => (
                                    <li key={opt} onClick={() => handleSelect(opt)} className="p-2 hover:bg-primary-100 cursor-pointer">
                                        {opt}
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}
                </div>
            );
        };

        // --- PAGE SECTIONS (V4) ---
        const PageHeader = ({ crName, crNumber, overallStatus, unreadCount, onToggleSidebar }) => (
            <div className="p-4 bg-gray-50/80 backdrop-blur-lg border-b border-gray-200 sticky top-0 z-30">
                <div className="max-w-full mx-auto flex justify-between items-center">
                    <div>
                        <p className="text-sm text-gray-500">{crNumber}</p>
                        <h1 className="text-2xl font-bold text-gray-900">{crName}</h1>
                    </div>
                    <div className="flex items-center gap-2">
                        <div className="flex items-center gap-2 p-2 rounded-lg bg-gray-100 border">
                            <span className="text-sm font-medium text-gray-600">Overall Status:</span>
                            <StatusBadge status={overallStatus} />
                        </div>
                        <Button variant="secondary">Save</Button>
                        <Button>Approve</Button>
                        <div className="h-8 border-l border-gray-300 mx-2"></div>
                        <div className="relative">
                            <Button onClick={onToggleSidebar} variant="ghost"><ICONS.MessageSquare size={20}/></Button>
                            {unreadCount > 0 && <span className="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"></span>}
                        </div>
                        <Button onClick={onToggleSidebar} variant="ghost"><ICONS.Menu size={20}/></Button>
                    </div>
                </div>
            </div>
        );

        const DetailsCard = ({ data }) => {
            const [isExpanded, setIsExpanded] = useState(false);
            const InfoItem = ({ label, value }) => <div className="mb-1"><p className="text-xs text-gray-500">{label}</p><p className="text-sm font-medium text-gray-800 break-words">{value || '-'}</p></div>;
            const BoolInfoItem = ({ label, value, description }) => <div className="flex items-center gap-2"><span className={`w-3 h-3 rounded-full ${value ? 'bg-green-500' : 'bg-red-500'}`}></span><p className="text-sm font-medium text-gray-800">{label}</p>{description && <div className="tooltip"><ICONS.Info className="text-gray-400 cursor-pointer" size={14}/><span className="tooltip-text">{description}</span></div>}</div>;
            const Section = ({ title, children, className }) => <div className={`py-3 px-4 ${className}`}><h3 className="text-xs font-semibold uppercase text-gray-400 mb-2">{title}</h3>{children}</div>;
            const CollapsedView = () => <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 p-4"><InfoItem label="Change Request" value={`${data.basicInfo.right.crName} (${data.basicInfo.left.crNumber})`} /><InfoItem label="Supplier" value={`${data.collapsed.supplierName} (${data.collapsed.supplierCode})`} /><InfoItem label="Part" value={`${data.collapsed.partName} (${data.collapsed.partNumber})`} /><InfoItem label="Coordinator" value={data.collapsed.coordinator} /><InfoItem label="Supplier Coordinator" value={data.collapsed.supplierCoordinator} /></div>;
            const ExpandedView = () => (
                <div className="fade-in border-t border-gray-200">
                    <div className="grid grid-cols-1 lg:grid-cols-3">
                        <Section title="Basic Information" className="lg:col-span-3"><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-1"><div>{Object.entries(data.basicInfo.left).map(([k, v]) => <InfoItem key={k} label={k.replace(/([A-Z])/g, ' $1').replace(/^./, s => s.toUpperCase())} value={v} />)}</div><div>{Object.entries(data.basicInfo.right).map(([k, v]) => <InfoItem key={k} label={k.replace(/([A-Z])/g, ' $1').replace(/^./, s => s.toUpperCase())} value={Array.isArray(v) ? v.map(l => l.name).join(', ') : v} />)}</div></div></Section>
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-3 border-t border-gray-200">
                         <Section title="Additional Details" className="lg:col-span-2"><div className="grid grid-cols-2 gap-2">{data.additionalDetails.map(item => <BoolInfoItem key={item.label} {...item} />)}</div></Section>
                    </div>
                </div>
            );
            return <Card><CardHeader><div className="flex items-center gap-3"><ICONS.Info className="text-gray-400" size={20}/><h2 className="text-lg font-semibold text-gray-800">Details</h2></div><Button onClick={() => setIsExpanded(!isExpanded)} variant="secondary">{isExpanded ? "Collapse" : "Expand"}<ICONS.ChevronDown className={`transition-transform ${isExpanded ? 'rotate-180' : ''}`} size={16} /></Button></CardHeader>{isExpanded ? <ExpandedView /> : <CollapsedView />}</Card>;
        };

        const RiskAndActionsCard = ({ initialRiskData, initialActionItems, users, riskLevels, onAddActionItem }) => {
            const [activeTab, setActiveTab] = useState('assessment');

            const AttachmentsCell = ({ attachments }) => <div className="relative group"><div className="flex items-center gap-1 cursor-pointer"><ICONS.Paperclip size={16} className="text-gray-500" /><span className="font-medium text-primary-600">{attachments.length}</span></div><div className="absolute z-20 bottom-full mb-2 w-60 bg-white border rounded-md shadow-lg p-2 hidden group-hover:block"><div className="text-center p-4 border-2 border-dashed border-gray-300 rounded-lg mb-2"><ICONS.UploadCloud className="mx-auto text-gray-400" size={24} /><p className="text-xs text-gray-500 mt-1">Drag & drop to upload</p></div><ul className="space-y-1">{attachments.map(att => <li key={att.id} className="flex justify-between items-center text-sm p-1 hover:bg-gray-100 rounded-md"><a href="#" className="truncate text-gray-700">{att.name}</a><button className="p-0.5 text-gray-400 hover:text-red-500"><ICONS.Trash2 size={14} /></button></li>)}</ul></div></div>;

            const RiskBadge = ({ risk }) => {
                const riskColor = {
                    "Critical": "bg-red-500",
                    "High": "bg-orange-500",
                    "Medium": "bg-yellow-500",
                    "Low": "bg-green-500",
                }[risk] || "bg-gray-400";
                return <div className={`w-3 h-3 rounded-full ${riskColor}`}></div>;
            };

            const RiskCategoryCard = ({ category, groupIdx, catIdx, onUpdate, users, riskLevels, onAddActionItem }) => {
                const [isExpanded, setIsExpanded] = useState(false);

                return (
                    <div className="border border-gray-200 rounded-lg mb-4">
                        <div className="p-4 cursor-pointer hover:bg-gray-50" onClick={() => setIsExpanded(!isExpanded)}>
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <RiskBadge risk={category.risk} />
                                    <h3 className="font-semibold text-gray-800">{category.category}</h3>
                                    <StatusBadge status={category.status} />
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="text-sm">
                                        <span className="text-gray-500">Risk: </span>
                                        <span className="font-medium">{category.risk}</span>
                                    </div>
                                    <div className="text-sm">
                                        <span className="text-gray-500">Responsible: </span>
                                        <span className="font-medium">{category.responsible}</span>
                                    </div>
                                    <ICONS.ChevronDown className={`transition-transform ${isExpanded ? 'rotate-180' : ''}`} size={20} />
                                </div>
                            </div>
                        </div>
                        {isExpanded && (
                            <div className="p-4 border-t border-gray-200 bg-gray-50/50">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <p className="text-xs text-gray-500 mb-1">Responsible</p>
                                        <EditableDropdown value={category.responsible} onSave={val => onUpdate(groupIdx, catIdx, 'responsible', val)} options={users} />
                                    </div>
                                    <div>
                                        <p className="text-xs text-gray-500 mb-1">Due Date</p>
                                        <EditableCell value={category.dueDate} onSave={val => onUpdate(groupIdx, catIdx, 'dueDate', val)} type="date" />
                                    </div>
                                    <div>
                                        <p className="text-xs text-gray-500 mb-1">Risk</p>
                                        <EditableDropdown value={category.risk} onSave={val => onUpdate(groupIdx, catIdx, 'risk', val)} options={riskLevels} />
                                    </div>
                                    <div>
                                        <p className="text-xs text-gray-500 mb-1">Status</p>
                                        <EditableCell value={category.status} onSave={val => onUpdate(groupIdx, catIdx, 'status', val)} />
                                    </div>
                                    <div className="md:col-span-2">
                                        <p className="text-xs text-gray-500 mb-1">Comments</p>
                                        <EditableCell value={category.comments} onSave={val => onUpdate(groupIdx, catIdx, 'comments', val)} />
                                    </div>
                                </div>
                                <div className="mt-4 pt-4 border-t border-gray-200 flex justify-between items-center">
                                    <div>
                                        <AttachmentsCell attachments={category.attachments} />
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Button variant="ghost"><ICONS.History size={16}/> View History</Button>
                                        <Button onClick={() => onAddActionItem(category.category)}><ICONS.Plus size={16}/> Add Action Item</Button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            const AssessmentTab = () => {
                const [riskData, setRiskData] = useState(initialRiskData);
                const handleUpdateCell = (groupIdx, catIdx, field, value) => {
                    const newData = { ...riskData };
                    newData.groups[groupIdx].categories[catIdx][field] = value;
                    setRiskData(newData);
                };

                const summary = riskData.groups.flatMap(g => g.categories).reduce((acc, cat) => {
                    if (cat.risk) {
                        acc[cat.risk] = (acc[cat.risk] || 0) + 1;
                    }
                    acc.total++;
                    return acc;
                }, { total: 0 });

                return (
                    <div>
                        <CardContent>
                            <h3 className="text-base font-semibold mb-3">Risk Overview</h3>
                            <div className="flex items-center gap-6">
                                <div className="text-center">
                                    <p className="text-3xl font-bold">{summary.total}</p>
                                    <p className="text-sm text-gray-500">Total Risks</p>
                                </div>
                                <div className="flex-grow grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {riskLevels.map(level => (
                                        <div key={level} className="flex items-center gap-3 bg-gray-50 p-3 rounded-lg">
                                            <RiskBadge risk={level} />
                                            <div>
                                                <p className="font-bold text-lg">{summary[level] || 0}</p>
                                                <p className="text-xs text-gray-600">{level}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </CardContent>
                        <CardContent>
                            {riskData.groups.map((group, groupIdx) => (
                                <div key={group.name}>
                                    <h2 className="text-base font-semibold text-gray-800 mt-4 mb-3">{group.name}</h2>
                                    {group.applicable ? (
                                        group.categories.map((cat, catIdx) => (
                                            <RiskCategoryCard
                                                key={cat.id}
                                                category={cat}
                                                groupIdx={groupIdx}
                                                catIdx={catIdx}
                                                onUpdate={handleUpdateCell}
                                                users={users}
                                                riskLevels={riskLevels}
                                                onAddActionItem={onAddActionItem}
                                            />
                                        ))
                                    ) : (
                                        <div className="border border-gray-200 rounded-lg mb-4 p-4 text-gray-500">Not applicable.</div>
                                    )}
                                </div>
                            ))}
                        </CardContent>
                    </div>
                );
            };

            const ActionItemsTab = () => <ActionItemsCard items={initialActionItems} />;

            return (
                <Card>
                    <div className="border-b border-gray-200">
                        <nav className="-mb-px flex space-x-6 px-4" aria-label="Tabs">
                            <button onClick={() => setActiveTab('assessment')} className={`${activeTab === 'assessment' ? 'border-primary-500 text-primary-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm`}>Assessment</button>
                            <button onClick={() => setActiveTab('actions')} className={`${activeTab === 'actions' ? 'border-primary-500 text-primary-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm`}>Action Items</button>
                        </nav>
                    </div>
                    {activeTab === 'assessment' ? <AssessmentTab /> : <ActionItemsTab />}
                </Card>
            );
        };

        const AuthorizationCard = ({ initialData, templates, users, loggedInUser, onUpdate, onSign }) => {
            const [authData, setAuthData] = useState(initialData);
            const [template, setTemplate] = useState("Standard Engineering Change");

            const handleTemplateChange = (newTemplate) => {
                setTemplate(newTemplate);
                const newRoles = templates[newTemplate].map(t => ({ ...t, user: '', status: 'Not Started', signature: '', date: '' }));
                setAuthData(newRoles);
                onUpdate(newRoles);
            };

            const handleUserChange = (roleIndex, newUser) => {
                const newData = [...authData];
                newData[roleIndex].user = newUser;
                if(newUser) {
                    newData[roleIndex].status = 'Pending';
                }
                setAuthData(newData);
                onUpdate(newData);
            };

            return (
                <Card>
                    <CardHeader><div className="flex items-center gap-3"><ICONS.Users className="text-gray-400" size={20} /><h2 className="text-lg font-semibold text-gray-800">Authorization</h2></div><div className="flex items-center gap-2"><label className="text-sm font-medium text-gray-600">Template:</label><select value={template} onChange={e => handleTemplateChange(e.target.value)} className="text-sm border-gray-300 rounded-md shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50">{Object.keys(templates).map(t => <option key={t}>{t}</option>)}</select></div></CardHeader><CardContent className="overflow-x-auto"><table className="w-full text-sm"><thead><tr className="text-left text-gray-500"><th>Level</th><th>Role</th><th>Assigned User</th><th>Status</th><th>Signature</th><th>Action</th></tr></thead><tbody>{authData.map((r, idx) => <tr key={r.role + r.level} className="border-t border-gray-200"><td className="p-2">{r.level}</td><td className="p-2 font-medium">{r.role}</td><td className="p-2 w-1/3"><SearchableDropdown value={r.user} onSave={newUser => handleUserChange(idx, newUser)} options={users} /></td><td className="p-2"><StatusBadge status={r.status} /></td><td className="p-2 font-mono text-sm">{r.signature || "-"}</td><td className="p-2 text-right">{r.user === loggedInUser && r.status !== 'Signed' && <Button onClick={() => onSign(idx)}>Sign</Button>}</td></tr>)}</tbody></table></CardContent>
                </Card>
            );
        };

        const ActionItemsCard = ({ items }) => {
            const statusOptions = ["Completed", "In Progress", "Pending", "Cancelled"];
            const statusColors = { "Completed": "text-green-600", "In Progress": "text-blue-600", "Pending": "text-yellow-600", "Cancelled": "text-red-600" };
            return <CardContent><table className="w-full text-sm"><thead><tr className="text-left text-gray-500 bg-gray-50"><th>#</th><th>Category</th><th>Action Name</th><th>Responsible</th><th>Due Date</th><th>Status</th><th></th></tr></thead><tbody>{items.map(item => <tr key={item.id} className="border-t border-gray-200"><td className="p-2 font-medium">{item.id}</td><td className="p-2">{item.assessmentCategory}</td><td className="p-2">{item.name}</td><td className="p-2">{item.responsible}</td><td className="p-2">{item.dueDate}</td><td className="p-2"><select defaultValue={item.status} className={`border-none bg-transparent text-sm font-medium p-0 focus:ring-0 ${statusColors[item.status]}`}><option value="Completed">Completed</option><option value="In Progress">In Progress</option><option value="Pending">Pending</option><option value="Cancelled">Cancelled</option></select></td><td className="p-2 text-right"><Button variant="ghost" className="!p-1"><ICONS.History size={16}/></Button></td></tr>)}</tbody></table></CardContent>;
        };
        const StatusHistoryCard = ({ history }) => <Card><CardHeader><div className="flex items-center gap-3"><ICONS.History className="text-gray-400" size={20} /><h2 className="text-lg font-semibold text-gray-800">Status History</h2></div></CardHeader><CardContent><ul className="space-y-3">{history.map(h => <li key={h.date + h.status} className="flex items-center gap-3"><ICONS.CheckCircle className="text-green-500" size={20} /><div><p className="font-medium text-gray-800">{h.status}</p><p className="text-sm text-gray-500">{h.user} on {h.date}</p></div></li>)}</ul></CardContent></Card>;
        
        const SupplierDetailsCard = ({ data }) => {
            const InfoItem = ({ label, value }) => <div><p className="text-xs text-gray-500">{label}</p><p className="text-sm font-medium text-gray-800 break-words">{value || '-'}</p></div>;
            return <Card><CardHeader><div className="flex items-center gap-3"><ICONS.Building className="text-gray-400" size={20} /><h2 className="text-lg font-semibold text-gray-800">Supplier Details</h2></div></CardHeader><CardContent className="space-y-2">{Object.entries(data).map(([k, v]) => <InfoItem key={k} label={k.replace(/([A-Z])/g, ' $1').replace(/^./, s => s.toUpperCase())} value={v} />)}</CardContent></Card>;
        };

        const RelatedPartsCard = ({ parts }) => (
            <Card>
                <CardHeader><div className="flex items-center gap-3"><ICONS.Package className="text-gray-400" size={20} /><h2 className="text-lg font-semibold text-gray-800">Related Part Numbers</h2></div></CardHeader>
                <CardContent className="max-h-48 overflow-y-auto">
                    <table className="w-full text-sm"><tbody>{parts.map(p => <tr key={p.number} className="border-b border-gray-100 last:border-b-0"><td className="p-1.5 font-mono text-primary-600">{p.number}</td><td className="p-1.5">{p.name}</td><td className="p-1.5 text-gray-500">Rev {p.revision}</td></tr>)}</tbody></table>
                </CardContent>
            </Card>
        );

        const ConversationCard = ({ conversation }) => <Card><CardHeader><div className="flex items-center gap-3"><ICONS.MessageSquare className="text-gray-400" size={20} /><h2 className="text-lg font-semibold text-gray-800">Conversation</h2></div></CardHeader><CardContent className="space-y-4">{conversation.map((c, i) => <div key={i} className="flex items-start gap-3"><img src={c.avatar} alt={c.user} className="w-8 h-8 rounded-full" /><div><div className="flex items-baseline gap-2"><p className="font-semibold text-gray-800">{c.user}</p><p className="text-xs text-gray-400">{c.time}</p></div><p className="text-sm text-gray-700">{c.text}</p></div></div>)}</CardContent><div className="p-2 border-t border-gray-200"><div className="flex items-center gap-2"><input type="text" placeholder="Type a message..." className="w-full text-sm border-gray-300 rounded-md shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50" /><Button><ICONS.Send size={16}/></Button></div></div></Card>;
        const ActionItemModal = ({ isOpen, onClose, category, onSave }) => { if (!isOpen) return null; const handleSubmit = (e) => { e.preventDefault(); const formData = new FormData(e.target); const newItem = { id: Date.now(), assessmentCategory: category, name: formData.get('name'), responsible: formData.get('responsible'), dueDate: formData.get('dueDate'), status: 'Pending' }; onSave(newItem); onClose(); }; return <div className="modal-overlay" onClick={onClose}><div className="modal-content fade-in" onClick={e => e.stopPropagation()}><h2 className="text-xl font-bold text-gray-900 mb-4">New Action Item for "{category}"</h2><form onSubmit={handleSubmit} className="space-y-4"><div><label htmlFor="name" className="block text-sm font-medium text-gray-700">Action Name</label><input type="text" name="name" id="name" required className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm" /></div><div><label htmlFor="description" className="block text-sm font-medium text-gray-700">Description</label><textarea name="description" id="description" rows="3" className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"></textarea></div><div><label htmlFor="responsible" className="block text-sm font-medium text-gray-700">Responsible User</label><select name="responsible" id="responsible" required className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"><option>Select User</option>{mockData.users.map(u=><option key={u} value={u}>{u}</option>)}</select></div><div><label htmlFor="dueDate" className="block text-sm font-medium text-gray-700">Due Date</label><input type="date" name="dueDate" id="dueDate" required className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm" /></div><div className="flex justify-end gap-3 pt-4"><Button type="button" variant="secondary" onClick={onClose}>Cancel</Button><Button type="submit">Create Action Item</Button></div></form></div></div>; };

        const SignatureModal = ({ isOpen, onClose, onSave, user }) => {
            if (!isOpen) return null;
            const [activeTab, setActiveTab] = useState('type');
            const [typedName, setTypedName] = useState(user);
            const signaturePadRef = useRef(null);

            useEffect(() => {
                if (activeTab === 'draw' && signaturePadRef.current) {
                    const canvas = signaturePadRef.current;
                    const ctx = canvas.getContext('2d');
                    let drawing = false;
                    
                    const getPos = (e) => {
                        const rect = canvas.getBoundingClientRect();
                        const scaleX = canvas.width / rect.width;
                        const scaleY = canvas.height / rect.height;
                        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                        return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
                    }

                    const startDrawing = (e) => { drawing = true; ctx.beginPath(); ctx.moveTo(getPos(e).x, getPos(e).y); };
                    const draw = (e) => { if (!drawing) return; e.preventDefault(); ctx.lineTo(getPos(e).x, getPos(e).y); ctx.stroke(); };
                    const stopDrawing = () => { drawing = false; };

                    canvas.addEventListener('mousedown', startDrawing);
                    canvas.addEventListener('mousemove', draw);
                    canvas.addEventListener('mouseup', stopDrawing);
                    canvas.addEventListener('mouseout', stopDrawing);
                    canvas.addEventListener('touchstart', startDrawing);
                    canvas.addEventListener('touchmove', draw);
                    canvas.addEventListener('touchend', stopDrawing);

                    return () => {
                        canvas.removeEventListener('mousedown', startDrawing);
                        canvas.removeEventListener('mousemove', draw);
                        canvas.removeEventListener('mouseup', stopDrawing);
                        canvas.removeEventListener('mouseout', stopDrawing);
                        canvas.removeEventListener('touchstart', startDrawing);
                        canvas.removeEventListener('touchmove', draw);
                        canvas.removeEventListener('touchend', stopDrawing);
                    };
                }
            }, [activeTab]);

            const clearCanvas = () => {
                const canvas = signaturePadRef.current;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            };

            const handleSave = () => {
                let signature = '';
                if (activeTab === 'type') signature = typedName;
                else if (activeTab === 'draw') signature = signaturePadRef.current.toDataURL();
                // Upload logic would go here
                onSave(signature, `Signed via ${activeTab}`);
                onClose();
            };

            const TabButton = ({ tab, children }) => <button type="button" onClick={() => setActiveTab(tab)} className={`px-4 py-2 text-sm font-medium rounded-t-lg ${activeTab === tab ? 'bg-white border-gray-200 border-t border-l border-r' : 'bg-gray-50 hover:bg-gray-100'}`}>{children}</button>;

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content fade-in !max-w-lg" onClick={e => e.stopPropagation()}>
                        <h2 className="text-xl font-bold text-gray-900 mb-4">Provide Signature</h2>
                        <div className="border-b border-gray-200 -mx-8 px-8 mb-4">
                            <TabButton tab="type"><ICONS.Edit size={16} className="inline-block mr-2"/>Type Signature</TabButton>
                            <TabButton tab="draw"><ICONS.Edit size={16} className="inline-block mr-2"/>Draw Signature</TabButton>
                            <TabButton tab="upload"><ICONS.Upload size={16} className="inline-block mr-2"/>Upload Image</TabButton>
                        </div>
                        <div className="space-y-4">
                            {activeTab === 'type' && <div><label htmlFor="typedName" className="block text-sm font-medium text-gray-700">Full Name</label><input type="text" name="typedName" value={typedName} onChange={e => setTypedName(e.target.value)} className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm" /><p className="text-xs text-gray-500 mt-2">By typing your name, you are electronically signing this document.</p></div>}
                            {activeTab === 'draw' && <div><canvas ref={signaturePadRef} width="450" height="200" className="border border-gray-300 rounded-md bg-white w-full"></canvas><Button type="button" variant="secondary" onClick={clearCanvas} className="mt-2"><ICONS.RotateCcw size={14}/> Clear</Button></div>}
                            {activeTab === 'upload' && <div><label htmlFor="sigUpload" className="block text-sm font-medium text-gray-700">Upload Signature File</label><input type="file" name="sigUpload" className="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"/></div>}
                        </div>
                        <div className="flex justify-end gap-3 pt-6 mt-4 border-t border-gray-200"><Button type="button" variant="secondary" onClick={onClose}>Cancel</Button><Button type="button" onClick={handleSave}>Sign and Submit</Button></div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        function App() {
            const [data, setData] = useState(mockData);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [modalCategory, setModalCategory] = useState('');
            const [isSidebarVisible, setIsSidebarVisible] = useState(true);
            const [loggedInUser, setLoggedInUser] = useState("Jane Doe"); // Mock logged in user
            const [isSignatureModalOpen, setIsSignatureModalOpen] = useState(false);
            const [signingIndex, setSigningIndex] = useState(null);

            const handleAddActionItem = (category) => { setModalCategory(category); setIsModalOpen(true); };
            const handleSaveActionItem = (newItem) => { setData(prevData => ({ ...prevData, actionItems: [...prevData.actionItems, newItem] })); };

            const handleAuthUpdate = (newAuthData) => {
                setData(prevData => ({
                    ...prevData,
                    authorization: {
                        ...prevData.authorization,
                        roles: newAuthData,
                    }
                }));
            };

            const handleOpenSignatureModal = (index) => {
                setSigningIndex(index);
                setIsSignatureModalOpen(true);
            };

            const handleSaveSignature = (signature, method) => {
                const newAuthData = [...data.authorization.roles];
                const roleToSign = newAuthData[signingIndex];
                roleToSign.status = 'Signed';
                roleToSign.signature = roleToSign.user.split(' ').map(n => n[0]).join('.') + '.'; // e.g., J.D.
                roleToSign.date = new Date().toISOString().split('T')[0];
                // In a real app, you'd store the full signature data and method
                handleAuthUpdate(newAuthData);
                setIsSignatureModalOpen(false);
                setSigningIndex(null);
            };

            return (
                <div className="flex flex-col h-screen">
                    <PageHeader crName={data.crName} crNumber={data.crNumber} overallStatus={data.overallStatus} unreadCount={data.unreadConversations} onToggleSidebar={() => setIsSidebarVisible(!isSidebarVisible)} />
                    
                    <main className="flex-grow overflow-y-auto">
                        <div className={`max-w-full mx-auto p-4 grid transition-all duration-300 ${isSidebarVisible ? 'grid-cols-1 lg:grid-cols-3 gap-6' : 'grid-cols-1'}`}>
                            {/* Left Column */}
                            <div className={`${isSidebarVisible ? 'lg:col-span-2' : 'max-w-7xl mx-auto w-full'} space-y-6`}>
                                <DetailsCard data={data.details} />
                                <RiskAndActionsCard initialRiskData={data.riskAssessment} initialActionItems={data.actionItems} users={data.users} riskLevels={data.riskLevels} onAddActionItem={handleAddActionItem} />
                                <AuthorizationCard
                                    initialData={data.authorization.roles}
                                    templates={data.authorization.templates}
                                    users={data.users}
                                    loggedInUser={loggedInUser}
                                    onUpdate={handleAuthUpdate}
                                    onSign={handleOpenSignatureModal}
                                />
                            </div>

                            {/* Right Column */}
                            {isSidebarVisible && (
                                <div className="lg:col-span-1 space-y-6 fade-in">
                                    <SupplierDetailsCard data={data.details.supplierDetails} />
                                    <RelatedPartsCard parts={data.details.relatedParts} />
                                    <StatusHistoryCard history={data.statusHistory} />
                                    <ConversationCard conversation={data.conversation} />
                                </div>
                            )}
                        </div>
                    </main>
                    
                    <ActionItemModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} category={modalCategory} onSave={handleSaveActionItem} />
                    <SignatureModal isOpen={isSignatureModalOpen} onClose={() => setIsSignatureModalOpen(false)} onSave={handleSaveSignature} user={signingIndex !== null ? data.authorization.roles[signingIndex].user : ''} />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>